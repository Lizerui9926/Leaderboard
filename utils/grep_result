#!/usr/bin/env python3
import sys, glob, os
import json

if (len(sys.argv) != 2):
    print("show_result.py pattern")
    exit(0)

pattern = sys.argv[1]
dir_list = glob.glob(pattern)

buffer=[]

print('MODEL,DATE,TESTSET,ACC,TER,n:H:R:MAX')
for dir in dir_list:
    date, service, test_set, max_utts = dir.split('__')
    results = os.path.join(dir, 'RESULTS.txt')
    try:
        with open(results, 'r', encoding = 'utf8') as f:
            for l in f:
                if 'token_error_rate' in l:
                    r = json.loads(l)
                    TER = r['token_error_rate']
                    R = r['num_ref_utts']
                    H = r['num_hyp_utts']
                    n = r['num_eval_utts']
                    buffer.append(F"{service},{date},{test_set},{100-TER:.2f},{TER:.2f},{n}:{H}:{R}:{max_utts}")
    except:
        continue

buffer.sort()

for l in buffer:
    print(l)
